name: Simple Deploy

on:
  push:
    branches: [ "main" ]

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 1. Create dist folder and copy EVERYTHING into it
    - name: Create dist folder
      run: |
        mkdir dist
        cp -r . dist/

    # 2. Clean workspace before switching branches
    - name: Clean workspace
      run: |
        find . -mindepth 1 -maxdepth 1 ! -name 'dist' ! -name '.git' -exec rm -rf {} +

    # 3. Deploy dist to gh-pages
    - name: Deploy to gh-pages
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"

        git checkout gh-pages

        git rm -rf . > /dev/null 2>&1 || true

        cp -r ../dist/* .

        git add .
        git commit -m "Deploy simple build" || echo "No changes to commit"
        git push origin gh-pages
